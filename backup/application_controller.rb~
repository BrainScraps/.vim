class ApplicationController < ActionController::Base
  # Prevent CSRF attacks by raising an exception.
  # For APIs, you may want to use :null_session instead.
  protect_from_forgery with: :exception
  before_filter :check_api_key, only: [:create, :update]

  protected

  def return_json(body, status)
    render json: body, status: status
  end

  def check_api_key
    authenticate_or_request_with_http_token do |token, options|
      ApiKey.exists?(access_token: token) && request.referer.include?(ApiKey.find_by_access_token(token).origin)
    end
  end
end
